---
title: Goå¤„ç†é”™è¯¯ä¼˜é›…åŒ–
categories: golang
tag: error
date: 2023-11-05
---
è¿™ç¯‡æ–‡ç« æ²¡æœ‰å«ã€Œæœ€ä½³å®è·µã€ï¼Œå› ä¸ºæˆ‘ä¹Ÿåœ¨æ‘¸ç´¢é˜¶æ®µï¼Œç›®å‰åªæ˜¯æ€»ç»“ä¸€ä¸‹ä¸ªäººè®¤ä¸ºæ¯”è¾ƒå¥½çš„æŠ€å·§ï¼Œä¸æ•¢è¯´å…¶æ™®é€‚æ€§å¦‚ä½•ã€‚å¦‚æœçœ‹å®˜ dalao å‘ç°äº†ç¼ºé™·æˆ–è€…æ›´å¥½åœ°æ–¹æ¡ˆï¼Œæ¬¢è¿è¯„è®ºæå‡ºã€‚

> å½“å‰ Go ç‰ˆæœ¬ 1.17.5

## Go çš„é”™è¯¯å¤„ç†è®¾è®¡

å…³äº Go çš„é”™è¯¯å¤„ç†ï¼Œä¸€ç›´äº‰è®®ä¸æ–­ã€‚å…¶å® Go æœ¬èº«çš„äº‰è®®ä¹Ÿä¸å°‘ ğŸ˜‚ã€‚è¿™é‡Œä¸è¿›è¡Œè¯„ä»·ï¼Œåªæ˜¯ç®€å•åœ°å’Œä¸»æµè¯­è¨€å¯¹æ¯”ï¼Œæ€»ç»“ä¸€ä¸‹ Go çš„ç‰¹å¾ã€‚

ä½œä¸ºä¸€ä¸ªå†å²æ‚ ä¹…çš„è¯­è¨€ï¼ŒC çš„é”™è¯¯å¤„ç†éå¸¸æ··ä¹±ã€‚å…¸å‹æƒ…å†µä¸‹ï¼ŒC é€šè¿‡è¿”å›å€¼è¡¨ç¤ºæ‰§è¡Œæ˜¯å¦æˆåŠŸï¼Œè‡³äºå¤±è´¥çš„å…·ä½“åŸå› ï¼Œé€šè¿‡é¢å¤–çš„å…¨å±€å˜é‡ä¼ é€’ã€‚è¿™ç§è®¾è®¡çš„è‡´å‘½ç¼ºé™·æ˜¯é”™è¯¯ä¸è¿”å›ç»“æœæ··æ·†åœ¨ä¸€èµ·ï¼Œä¾‹å¦‚å‡½æ•°Â `int atoi(const char *str)`Â ï¼Œå¦‚æœè½¬æ¢å‡ºé”™åº”è¯¥è¿”å›ä»€ä¹ˆå‘¢ï¼Ÿ0ï¼Ÿ-1ï¼Ÿå…¶å®éƒ½ä¸åˆç†ï¼Œå› ä¸ºä»»ä½•æ•°å­—éƒ½æœ‰å¯èƒ½ä»£è¡¨ä¸€ä¸ªæ­£å¸¸çš„ç»“æœã€‚

ä¸ºæ­¤ï¼Œéƒ¨åˆ†å¼€å‘è€…é€‰æ‹©åˆ©ç”¨æŒ‡é’ˆä¼ é€’ç»“æœï¼Œè€Œè¿”å›å€¼ä»…è¡¨ç¤ºæ˜¯å¦å‡ºé”™ã€‚è¿™ç¡®å®è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œä½†åˆå¯¼è‡´äº†ã€Œå‚æ•°ã€è¯­ä¹‰çš„æ··æ·†ã€‚æ²¡æœ‰ç»éªŒçš„åŒå­¦çœ‹åˆ°ä»€ä¹ˆå…¥å‚å‡ºå‚æçš„ä¸€è„¸æ‡µæ¯”ã€‚

è€Œè¿‘ç°ä»£è¯­è¨€é€šå¸¸é‡‡ç”¨Â `try-catch`Â çš„æ€æƒ³ã€‚ä¾‹å¦‚ java ä¸ pythonã€‚è¿™ç§æ¨¡å‹æ—¢åˆ†ç¦»çš„é”™è¯¯ä¸è¿”å›å€¼å’Œå‚æ•°ï¼Œä¹Ÿæä¾›äº†ç»“æ„åŒ–å¤„ç†çš„å¯èƒ½ã€‚é€šè¿‡é¢ç›¸å¯¹è±¡çš„æ€æƒ³ï¼Œå¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰é”™è¯¯ç±»ã€å­ç±»ï¼Œå®ƒä»¬åˆå¯ä»¥åŒ…è£…å…¶ä»–é”™è¯¯ï¼Œç¡®ä¿é”™è¯¯ä¸Šä¸‹æ–‡ä¸ä¼šä¸¢å¤±ã€‚

---

Go åˆ™ä¸ä¼—ä¸åŒã€‚å®ƒåˆ©ç”¨å¤šè¿”å›å€¼çš„ç‰¹æ€§åšåˆ°äº†é”™è¯¯çš„åˆ†ç¦»ï¼Œå› æ­¤ï¼Œå¾ˆå¤š Go çš„å‡½æ•°æœ€åä¸€ä¸ªè¿”å›å€¼éƒ½æ˜¯ä¸€ä¸ªÂ `error`Â æ¥æ ‡è¯†æ˜¯å¦å‡ºé”™ã€‚ç›¸æ¯”äº C è¿™æ˜¯ä¸€ä¸ªè¿›æ­¥ï¼Œä½†æ²¡æœ‰æä¾›çµæ´»çš„æ•è·æœºåˆ¶ï¼Œè¿™å°±ä»è€…è§ä»æ™ºè€…è§æ™ºäº†ã€‚

**æˆ‘ä¸ªäººçš„è§‚ç‚¹æ˜¯ï¼šä¸åº”è¯¥è¯•å›¾åœ¨ A è¯­è¨€ä¸­å¤åˆ» B è¯­è¨€çš„åŠŸèƒ½ï¼Œè€Œæ˜¯æ ¹æ®è¯­è¨€è‡ªèº«çš„ç‰¹ç‚¹ï¼Œåœ¨å®è§‚ç†å¿µçš„æŒ‡å¯¼ä¸‹ï¼Œå®ç°é’ˆå¯¹æ€§çš„é”™è¯¯å¤„ç†æ–¹æ¡ˆã€‚**Â åæ–‡å°†ä»¥è¿™ä¸ªè§‚ç‚¹ä¸ºç»§ç»­è¿›è¡Œæ¢ç´¢ã€‚

## åŸºæœ¬ç†å¿µ

è™½ç„¶è¯­æ³•ä¸åŒï¼Œä½†æ˜¯ä¸€äº›è¯­è¨€æ— å…³çš„æ€æƒ³è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡éµå¾ªã€‚

é¦–å…ˆï¼Œä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œè‡³å°‘è¦å…·æœ‰ä¸¤ä¸ªä½œç”¨ï¼š

1. ç»™ç¨‹åºçœ‹ã€‚å¯ä»¥æ ¹æ®é”™è¯¯ç±»å‹è¿›å…¥å¤„ç†åˆ†æ”¯ã€‚
2. ç»™äººçœ‹ã€‚å‘Šè¯‰æˆ‘ä»¬åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚

### ä¸è¦é‡å¤å¤„ç†é”™è¯¯

ç§ä»¥ä¸ºè¿™æ˜¯å¾ˆå®¹æ˜“è¸©çš„ä¸€ä¸ªå‘ï¼Œè€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼š

```go
func foo() (Result, error) {
 result, err := repository.Find(id)
 if err != nil {
   log.Errof(err)
   return Result{}, err
 }
  return result, nil
}
```

è¿™é‡Œæ‰“å°äº†é”™è¯¯ï¼ˆç›¸å½“äºå¤„ç†ï¼‰ï¼Œç„¶åè¿”å›å®ƒã€‚å¯ä»¥æƒ³è±¡ï¼Œ`foo()`Â çš„è°ƒç”¨æ–¹ä¼šå†æ¬¡æ‰“å°ï¼Œå†è¿”å›ã€‚æœ€ç»ˆä¸€ä¸ªé”™è¯¯ä¼šæ‰“å°å‡ºä¸€å¤§å †ä¸œè¥¿ã€‚

### é”™è¯¯è¦åŒ…å«è°ƒç”¨æ ˆ

è°ƒç”¨æ ˆæ˜¯ debug çš„åŸºæœ¬éœ€è¦ã€‚å¦‚æœä»…ä»…æ˜¯ä¸€å±‚å±‚è¿”å› errorï¼Œé‚£ä¹ˆæœ€é¡¶å±‚çš„å‡½æ•°å°†æ”¶åˆ°æœ€åº•å±‚çš„é”™è¯¯ã€‚è¯•æƒ³ä½ ç”¨ Go å†™äº†ä¸€ä¸ª web åç«¯ï¼Œåœ¨å¤„ç†ä¸€ä¸ªæ”¯ä»˜è¯·æ±‚æ—¶å‡ºç°äº† io é”™è¯¯ã€‚è¿™å¯¹ debug æ¯«æ— å¸®åŠ©â€”â€”æ— æ³•å®šä½å“ªä¸ªç¯èŠ‚å‡ºé”™ã€‚

å¦ä¸€ä¸ªä¸å¥½çš„æ–¹æ¡ˆæ˜¯ï¼Œæ¯ä¸€å±‚åªè¿”å›è‡ªå·±çš„é”™è¯¯ï¼Œä¾‹å¦‚ï¼š
```go
func pay(){
  if err := checkOrder(); err!=nil {
    return errors.New("æ”¯ä»˜å¼‚å¸¸")
  }
  return nil
}

func checkOrder() error {
  if err := calcMoney(); err!=nil {
    return errors.New("è®¡ç®—é‡‘é¢å¼‚å¸¸")
  }
  return nil
}

func calcMoney() error {
  if err := querySql(); err!=nil {
    return errors.New("æŸ¥è¯¢æ•°æ®åº“å¼‚å¸¸")
  }
  return nil
}
```
è¿™ç§æƒ…å†µå’Œä¸Šä¸€ç§ç›¸åï¼šé¡¶å±‚å‡½æ•°åªèƒ½å¾—åˆ°æœ€è¿‘çš„é”™è¯¯ï¼Œå¯¹å¼•å‘çš„åŸå› ä¸€æ— æ‰€çŸ¥ï¼Œæ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çš„ã€‚

### é”™è¯¯è¦æ˜¯ç»“æ„åŒ–çš„

æœ‰èªæ˜çš„åŒå­¦æ”¹é€ äº†ä¸€ä¸‹ä»£ç æ¥è§£å†³ä¸¢å¤±è°ƒç”¨æ ˆçš„é—®é¢˜ï¼š
```go
func checkOrder() error {
  if err := calcMoney(); err!=nil {
    return fmt.Errorf("è®¡ç®—é‡‘é¢å¼‚å¸¸ï¼š%s", err)
  }
  return nil
}
```
ç¡®å®ï¼Œä¿®æ”¹åé¡¶å±‚å‡½æ•°å¾—åˆ°çš„å¼‚å¸¸å¦‚ä¸‹ï¼š

> æ”¯ä»˜å¼‚å¸¸ï¼šè®¡ç®—é‡‘é¢å¼‚å¸¸ï¼šæŸ¥è¯¢æ•°æ®åº“å¼‚å¸¸

ç°åœ¨åŸºæœ¬ä¸Šå¯ä»¥çœ‹å‡ºè°ƒç”¨æ ˆäº†ï¼Œ**ä½†ä»…é™äºäººç±»**ã€‚è¿™ä¸ªé”™è¯¯æ˜¯å¦å±äºæ•°æ®åº“å¼‚å¸¸ï¼Ÿè®¡ç®—æœºæ— ä»å¾—çŸ¥ã€‚~~æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€å¤„ç†æ¥è§£å†³~~ï¼Œé™¤éä½ ç–¯äº†ã€‚

æ‰€ä»¥éœ€è¦ç»“æ„åŒ–é”™è¯¯â€”â€”é”™è¯¯æœ‰åŒ…å«å…³ç³»ï¼Œå­é”™è¯¯æ˜¯çˆ¶é”™è¯¯çš„ä¸€ç§ï¼Œé¡¶å±‚å‡½æ•°å¯ä»¥è½»æ¾åˆ¤æ–­å¼‚å¸¸ç±»å‹ã€‚

### é”™è¯¯è¦æœ‰ä¸Šä¸‹æ–‡

è¿™ä¸€ç‚¹å¾ˆå¥½ç†è§£äº†ï¼Œæˆ‘ä»¬å¸Œæœ›é”™è¯¯æ—¥å¿—åŒ…å«ä¸€äº›ç›¸å…³çš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ· idï¼Œè®¢å• id ç­‰ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåŸåˆ™è¦å’Œã€Œä¸é‡å¤å¤„ç†ã€ç»“åˆï¼Œå¦åˆ™å°†ä¼šå¾—åˆ°è¿™æ ·çš„å¤©ä¹¦ logï¼š

> æ”¯ä»˜å¼‚å¸¸ uid=123, orderId=456, reqId=328952104ï¼šè®¡ç®—é‡‘é¢å¼‚å¸¸ uid=123, orderId=456, reqId=328952104ï¼šæŸ¥è¯¢æ•°æ®åº“å¼‚å¸¸ uid=123, orderId=456, reqId=328952104

## å®è·µ

### é”™è¯¯é“¾

æ›¾ç»ï¼Œåœ¨ Go ä¸­åšåˆ°ä¿ç•™è°ƒç”¨æ ˆå’Œç»“æ„åŒ–æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œä¸ºæ­¤Â [errors](https://github.com/pkg/errors)Â å¼€æºåº“è¢«å¹¿æ³›ä½¿ç”¨ã€‚ä¸è¿‡ Go 1.13 ä¸€å®šç¨‹åº¦ä¸Šå¢å¼ºäº†é”™è¯¯å¤„ç†ï¼ŒGo 2 ä¹Ÿè®¡åˆ’è¿›ä¸€æ­¥æ”¹å–„ã€‚å› æ­¤è¿™ä¸ªåº“å·²è¿›å…¥ç»´æŠ¤çŠ¶æ€ã€‚

ç°åœ¨ï¼Œè°ƒç”¨æ ˆä¸å†éœ€è¦æˆ‘ä»¬è‡ªå·±æ„é€ ï¼Œé€šè¿‡Â `fmt.Errorf("... %w", ..., err)`Â å°±å¯ä»¥åŒ…è£…ä¸€ä¸ªé”™è¯¯ï¼Œå±‚å±‚å¥—å¨ƒå½¢æˆé”™è¯¯é“¾ã€‚ç›¸åº”çš„ï¼Œé€šè¿‡Â `errors.Is()`Â æˆ–Â `errors.As()`Â å¯ä»¥åˆ¤æ–­ä¸€ä¸ªé”™è¯¯ï¼ˆé“¾ï¼‰æ˜¯å¦æ˜¯ï¼ˆåŒ…å«ï¼‰å¦ä¸€ä¸ªé”™è¯¯ï¼Œå‰è€…è¦æ±‚ä¸¥æ ¼ç›¸ç­‰ï¼Œåè€…åªéœ€ç±»å‹ä¸€è‡´ã€‚ä¸çŸ¥ä¸è§‰ä¸­ï¼Œã€Œç»“æ„åŒ–ã€ä¹ŸåŸºæœ¬ä¸Šå®ç°äº†ã€‚

ç­‰ç­‰ï¼ä¸ºä»€ä¹ˆè¯´ã€ŒåŸºæœ¬ã€ï¼Ÿè™½ç„¶æ ‡å‡†åº“æä¾›äº†åˆ¤æ–­é”™è¯¯ç±»å‹çš„æ–¹æ³•ï¼Œä½†æ˜¯é”™è¯¯ç±»å‹æ˜¯å•¥ï¼Ÿç›¸æ¯” java ä¸­æŠ›å‡ºä¸€ä¸ªå…·ä½“å¼‚å¸¸ï¼ŒGo ä¸­åŸºæœ¬ä¸Šåªä¼šè¿”å›åº•å±‚é”™è¯¯æ¥å£Â `error`ï¼Œè€Œæ²¡æœ‰å…·ä½“ç»“æ„ä½“ï¼Œé‚£æ€ä¹ˆåˆ¤æ–­å‘€ï¼Ÿéš¾é“åˆè¦å›åˆ°Â `err.msg`Â çš„æ—¶ä»£ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼ŒåŒ…è£…ä¸€ä¸ªé”™è¯¯ï¼Œé™¤äº†ä½¿ç”¨Â `fmt`Â ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ã€‚å®é™…ä¸Šï¼Œ`fmt.Errorf()`Â è¿”å›çš„æ˜¯Â `wrapError`ï¼Œç›¸å½“äºæ˜¯ä¾¿æ·å‡½æ•°ï¼Œç”¨äºæ— éœ€æ˜ç¡®é”™è¯¯ç±»å‹çš„åœºæ™¯ã€‚

### è‡ªå®šä¹‰ç»“æ„ä½“

è‡ªå®šä¹‰é”™è¯¯ç»“æ„ä½“ä¸ä»…å¸®åŠ©è¯†åˆ«é”™è¯¯ç±»å‹ï¼Œè¿˜é¡ºä¾¿è§£å†³äº†ä¸‹ä¸Šä¸‹æ–‡é—®é¢˜ã€‚é€šè¿‡ç®€å•çš„ string è‡ªç„¶æ˜¯ OK çš„ï¼Œä¸è¿‡ä¸ºäº†è®©ä¸Šä¸‹æ–‡æœ¬èº«ä¹Ÿå¯ä»¥è¢«ç¨‹åºè¯†åˆ«ï¼Œæ›´å¥½çš„åŠæ³•æ˜¯ä½œä¸ºç»“æ„ä½“çš„ä¸€ä¸ªå­—æ®µï¼š
```go
type orderError struct {
  orderId int
  msg string
  err error
}

func (e *orderError) Error() string {
    return e.msg
}

func (e *orderError) Unwrap() error {
    return e.err
}
```

è¿™ä¸ªç»“æ„ä½“ä¸ä»…å®ç°äº† error æ¥å£ï¼Œè¿˜é¢å¤–æ‹¥æœ‰Â `Unwrap()`Â æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥åŒ…è£…å…¶ä»–å¼‚å¸¸ï¼Œç¡®ä¿ä¸ä¸¢å¤±è°ƒç”¨æ ˆã€‚

é‚£ä¹ˆå°±å¯ä»¥è¿™ä¹ˆæ¥è¿”å›ï¼š
```go
func checkOrder() error {
  if err := calcMoney(); err!=nil {
    return return orderError{123, "è®¡ç®—é‡‘é¢å¼‚å¸¸", err}
  }
  return nil
}
```
### å…¬å¼€ OR ç§æœ‰

æœ‰äº†è‡ªå·±çš„ç»“æ„ä½“ï¼Œéšä¹‹è€Œæ¥çš„å°±æ˜¯å®ƒéœ€è¦å…¬å¼€å—ï¼Ÿè¿™ä¸ªé—®é¢˜æ ‡å‡†åº“å·²ç»ç»™å‡ºäº†ç­”æ¡ˆï¼šä¸€èˆ¬ä¸éœ€è¦ã€‚æ‰€ä»¥æˆ‘ä»¬è§åˆ°çš„å¤§å¤šæ•°å‡½æ•°ï¼Œåªè¿”å›Â `error`Â è€Œä¸æ˜¯Â `xxxError`ã€‚æ ¹æ®ç½‘ä¸Šçš„èµ„æ–™ï¼Œè¿™ä¹ˆåšæ—¨åœ¨éšè—å®ç°ç»†èŠ‚ï¼Œæé«˜ lib çš„çµæ´»æ€§ï¼Œå‡å°‘å‡çº§æ—¶éœ€è¦è€ƒè™‘çš„å…¼å®¹é—®é¢˜ã€‚

ä¸å…¬å¼€ç»“æ„ä½“ï¼Œä¹Ÿå°±æ˜¯æ„å‘³ç€å¤–éƒ¨æ— æ³•é€šè¿‡Â `errors.As()`Â åˆ¤æ–­äº†ï¼Œä¸ºæ­¤ï¼Œéœ€è¦å…¬å¼€ä¸€ä¸ªå‡½æ•°å¸®åŠ©å¤–éƒ¨ç¡®è®¤è¿™æ˜¯å¦æ˜¯å±äºæœ¬ lib çš„é”™è¯¯ã€‚
```go
func IsOrderError(err error) bool {
  return errors.As(err, orderError)
}
```
## Error Check Hell

ä¸Šé¢å·²ç»æ€»ç»“äº†è¿”å›é”™è¯¯çš„ç»“æ„ï¼Œç¬¦åˆä¸€å¼€å§‹æå‡ºçš„åŸºæœ¬ç†å¿µã€‚åœ¨å®é™…ä»£ç ä¸­ï¼Œé”™è¯¯æ£€æŸ¥å¯èƒ½ä¼šå……æ–¥ç€é¡¹ç›®ï¼Œç”šè‡³æ¯ä¸€ä¸ªè°ƒç”¨éƒ½è£¹ç€ä¸€ä¸ªÂ `if`Â æ¥åŠæ—¶æ‰“æ–­å¹¶è¿”å›â€”â€”å› ä¸º Go æ²¡æœ‰ throw æˆ– raise æœºåˆ¶ã€‚çœ‹ä¸‹é¢è¿™ä¸ªæ¶å¿ƒçš„ä¾‹å­ï¼š
```go
func checkPersion(*p Persion) error {
  if err := checkAttr(p.name); err != nil{
    return err
  }
  if err := checkAttr(p.age); err != nil{
    return err
  }
  if err := checkAttr(p.country); err != nil{
    return err
  }
  if err := checkAttr(p.work); err != nil{
    return err
  }
  return nil
}
```

### æŠ½å–åŒ¿åå‡½æ•°

> æ­¤æ–¹æ³•é€‚ç”¨äºè¿ç»­è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ã€‚

æŠŠé”™è¯¯æ£€æŸ¥æŠ½å–åˆ°åŒ¿åå‡½æ•°ä¸­ï¼Œè‹¥å·²ç»å­˜åœ¨é”™è¯¯ï¼Œé‚£ä¹ˆä¸çœŸæ­£æ‰§è¡Œï¼Œç›´æ¥è¿”å›ã€‚
```go
func checkPersion(*p Persion) error {
  var err error
  check := func(attr interface{}){
    if err != nil{
      return
    }
    err = checkAttr(attr)
  }

  check(p.name)
  check(p.age)
  check(p.country)
  check(p.work)
  // more check
  return err
}
```

### åˆ©ç”¨ panic

> âš ï¸ ä½¿ç”¨ panic æ¥ä»£æ›¿ error æ˜¯é”™è¯¯çš„ä¹ æƒ¯ã€‚ä¸è¦æ»¥ç”¨æ­¤æŠ€å·§ã€‚

```go
// checkAttr() ä¸å†è¿”å› error è€Œæ˜¯ç›´æ¥ panic
func checkAttr(attr interface{}) {
  if attr == nil{
    panic(checkErr{...})
  }
}

func checkPersion(*p Persion) (err error) {
  defer func() {
    if r := recover(); r != nil {
      // æ¢å¤ checkAttr() çš„ panic è½¬ä¸º error
      err = r.(checkErr)
    }
  }()

  // do any thing
}

```

ç”¨ panic ç®€åŒ– check çš„å…³é”®åœ¨äº recover æ—¶åªå¤„ç†å·²çŸ¥çš„é”™è¯¯ï¼Œå¯¹äºæœªçŸ¥æƒ…å†µåº”è¯¥ç»§ç»­ä¼ é€’ panicã€‚å› ä¸º panic åŸåˆ™ä¸Šä»…ç”¨äºä¸å¯æ¢å¤çš„ä¸¥é‡é”™è¯¯ï¼ˆä¾‹å¦‚æ•°ç»„è¶Šç•Œï¼‰ï¼Œå¦‚æœä¸åˆ†æƒ…å†µä¸€å¾‹ recover åˆ™å¯èƒ½ä¼šæ©ç›– bug å¼•å‘æœªçŸ¥çš„åæœã€‚

æœ‰çš„ç½‘ç«™ç»™å‡ºä¸‹é¢è¿™ç§å†™æ³•ï¼Œéå¸¸ä¸æ¨èï¼Œé™¤éä½ çŸ¥é“è‡ªå·±åœ¨å¹²å˜›ï¼š
```go
func checkPersion(*p Persion) (err error) {
  defer func() {
    if r := recover(); r != nil {
      var ok bool
      // è¿™é‡Œå¯¹äºæœªçŸ¥é”™è¯¯ä¹Ÿä¸€å¹¶æ•è·äº†
      err, ok = r.(error)
      if !ok {
        err = fmt.Errorf("failed to check persion: %v", r)
      }
    }
  }()
  // do any thing
}
```

å°½ç®¡å¾ˆå¤šç½‘ç«™éƒ½å®£ä¼ ä¸è¦æ»¥ç”¨ panicï¼Œä½†æˆ‘è®¤ä¸ºï¼Œå¦‚æœåƒç¬¬ä¸€ä¸ªä¾‹å­é‚£æ ·ï¼Œç¡®ä¿è‡ªå·±åªæ•è·å·²çŸ¥çš„å¼‚å¸¸æ¥ç®€åŒ– error checkï¼Œåº”è¯¥ä¸ç®—åšæ»¥ç”¨â€”â€”æ­¤æ—¶ panic ä¸ä¼šå¯¹åŒ…å¤–éƒ¨çš„è°ƒç”¨è€…é€ æˆä»»ä½•å½±å“â€”â€”åŸæ¥ä¼š panic çš„ç°åœ¨ä¾ç„¶ä¼š panicï¼ŒåŸæ¥ä¼šè¿”å› error çš„ç°åœ¨ä¾ç„¶åªè¿”å› errorã€‚Go çš„å®˜æ–¹æ–‡æ¡£Â [effective go](https://go.dev/doc/effective_go)Â ä¹Ÿæ‰¿è®¤äº†è¿™ç§ç”¨æ³•ï¼š

> With our recovery pattern in place, theÂ `do`Â function (and anything it calls) can get out of any bad situation cleanly by callingÂ `panic`. We can use that idea to simplify error handling in complex software.

æœ‰äº† recovery æ¨¡å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥éšæ—¶é€šè¿‡è°ƒç”¨ panic ç®€å•åœ°æ‘†è„±å¼‚å¸¸æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ€æƒ³æ¥ç®€åŒ–å¤æ‚è½¯ä»¶ä¸­çš„é”™è¯¯å¤„ç†ã€‚